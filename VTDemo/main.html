<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">

		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<title>VOXTOX</title>
		<meta name="description" content="VoxTox">
		<meta name="author" content="Sam">
		
	</head>

	<body>
		<div>
			<header>
				<h1>VOXTOX</h1>
			</header>
			<canvas id="render"width="400"height="400"></canvas>
			<script type="text/javascript" src="resource/js/game.js"></script>
			<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
			<script type="text/javascript">
				var DEBUG = true;
				if(typeof console == "undefined"){
					DEBUG = false;
				}
				var canvas = document.getElementById('render');
				var ctx = canvas.getContext("2d");
				var worlds;
				function LoadWorld(files)
				{
					$.ajax({//Loading function
						url:"resource/xml/"+files+".xml",
						dataType:"xml",
						success:function(xml) {
							var xml = $('xml',xml);
							//CanArrCount = parseInt(xml.find( "amount" ).text());
							//CanArr = new Array(CanArrCount);
							worlds = new World(parseInt(xml.find( "Xsize" ).text())
											,parseInt(xml.find( "Ysize" ).text()));
							$(xml).find("data").each(function(){
							var Set = 0;
							$(this).find("cell").each(function(){
								worlds.Cells[Set].Type = parseInt($(this).text());
								worlds.Cells[Set].X = ~~((Set/worlds.SizeX) - ~~(Set/worlds.SizeX)*worlds.SizeX) - 1;
								worlds.Cells[Set].Y = ~~(Set/worlds.SizeX) - 1;
								console.log(worlds.Cells[Set].X);
								Set += 1;
							});
							});
						}
					});
				}
				function MainLoop()
				{
					if(DEBUG){console.log("update");}
					//world.Update();
					if(worlds.Clear == true)//clear if updated
					{
						ctx.clearRect(0,0,100,100);
						worlds.Clear = false;
					}
					if(DEBUG){console.log("clear");}
					for(var i = 0;i <worlds.CellCount;++i)
					{
						if(worlds.CellRender[i] == true)
						{
							ctx.fillStyle = "#FF0000";//Render
							ctx.fillRect(worlds.Cells[i].X-10,worlds.Cells[i].Y-10,20,20); 
							worlds.CellRender[i] = false;
						}
					}
					worlds.Cells[0].X += 1;
					setTimeout("MainLoop()",200);
				}
				worlds = new World();
				if(DEBUG){console.log("built world");}
				if(LoadWorld("test"))
				{
					MainLoop();
				}
				else
				{
					alert("load failed");
				}
			</script>
			<footer>
				<p>
				</p>
			</footer>
		</div>
	</body>
</html>
